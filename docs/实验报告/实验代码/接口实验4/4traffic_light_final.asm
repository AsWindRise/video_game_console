;============================================================
; 交通灯控制系统 - 8086汇编程序
;
; 硬件配置:
;   - 8255可编程并行接口 (基址: 200H)
;   - 8253可编程定时器 (基址: 400H)
;   - 6个LED模拟交通灯 (连接至8255 PA口)
;   - 8253计数器2输出连接CPU的NMI引脚
;
; 功能描述:
;   实现十字路口交通灯自动控制
;   南北方向与东西方向交替放行,包含黄灯闪烁过渡
;
; 时序设计:
;   南北绿灯(10s) → 南北黄灯闪烁(5s) →
;   东西绿灯(10s) → 东西黄灯闪烁(5s) → 循环
;
; 作者: [你的姓名]
; 日期: [日期]
;============================================================

;============================================================
;                    系统原理详解
;============================================================
;
; 【十字路口交通灯工作原理】
;
;   真实十字路口有两个方向: 南北方向 和 东西方向
;   每个方向有3盏灯: 红灯、黄灯、绿灯
;   两个方向不能同时绿灯(会撞车!)
;
;   标准交通灯时序:
;   ┌────────┬────────┬────────┬────────┬────────┐
;   │ 阶段1  │ 阶段2  │ 阶段3  │ 阶段4  │ 阶段1  │
;   ├────────┼────────┼────────┼────────┼────────┤
;   │南北:绿 │南北:黄闪│南北:红 │南北:红 │南北:绿 │
;   │东西:红 │东西:红 │东西:绿 │东西:黄闪│东西:红 │
;   ├────────┼────────┼────────┼────────┼────────┤
;   │ 10秒   │ 5秒    │ 10秒   │ 5秒    │ 10秒   │
;   └────────┴────────┴────────┴────────┴────────┘
;                        ↑
;                    一个完整周期 = 30秒
;
; 【PA口与交通灯的连接】
;
;   PA口是8位输出,我们用其中6位控制6盏灯:
;
;   PA5 ──→ 南北绿灯 (0=亮, 1=灭)
;   PA4 ──→ 南北黄灯 (0=亮, 1=灭)
;   PA3 ──→ 南北红灯 (0=亮, 1=灭)
;   PA2 ──→ 东西绿灯 (0=亮, 1=灭)
;   PA1 ──→ 东西黄灯 (0=亮, 1=灭)
;   PA0 ──→ 东西红灯 (0=亮, 1=灭)
;
;   注意: 低电平点亮LED!
;
; 【灯状态编码详解】
;
;   以"南北绿灯,东西红灯"为例:
;   需要: 南北绿=亮(0), 南北黄=灭(1), 南北红=灭(1)
;         东西绿=灭(1), 东西黄=灭(1), 东西红=亮(0)
;
;   PA口值: PA7 PA6 PA5 PA4 PA3 PA2 PA1 PA0
;           0   0   0   1   1   1   0   1  = 35H
;                   ↑   ↑   ↑   ↑   ↑   ↑
;                  南北绿亮 南北黄灭 南北红灭 东西绿灭 东西黄灭 东西红亮
;
; 【定时系统原理】
;
;   100kHz ──→ 8253计数器0 ──→ 8253计数器2 ──→ NMI中断
;              (÷100=1kHz)    (÷1000=1秒)
;                             (÷500=0.5秒)
;
;   程序通过轮询delay_flag标志等待定时完成
;   NMI中断服务程序设置delay_flag=1表示定时完成
;
; 【程序结构】
;
;   本程序采用模块化设计,包含以下子程序:
;   - INIT_NMI: 初始化中断向量
;   - INIT_8255: 初始化并行接口
;   - INIT_8253_CNT0: 初始化时基发生器
;   - SET_LIGHT: 设置灯状态
;   - DELAY_SECONDS: 秒级延时
;   - DELAY_HALF_SECOND: 半秒延时(黄灯闪烁用)
;   - NMI_ISR: 中断服务程序
;
;============================================================

.MODEL SMALL                    ; 使用小模式(代码段+数据段各64KB)
.8086                           ; 使用8086指令集
.STACK 256                      ; 堆栈大小256字节

;============================================================
; 常量定义
;============================================================

;--------------------- 8255端口地址 ---------------------
; 8255是并行接口芯片,用于输出控制信号到交通灯
PORT_8255_PA    EQU 200H        ; PA口地址 - 连接6个交通灯LED
PORT_8255_CTRL  EQU 206H        ; 控制字寄存器地址

;--------------------- 8253端口地址 ---------------------
; 8253是定时/计数器芯片,用于产生精确定时
PORT_8253_CNT0  EQU 400H        ; 计数器0地址 (产生1kHz时基)
PORT_8253_CNT2  EQU 404H        ; 计数器2地址 (产生定时中断)
PORT_8253_CTRL  EQU 406H        ; 控制字寄存器地址

;--------------------- 8255控制字 ---------------------
; 8255控制字格式:
;   D7: 1=方式选择, 0=位操作
;   D6-D5: A组方式 (00=方式0)
;   D4: PA方向 (0=输出, 1=输入)
;   D3: PC高4位方向
;   D2: B组方式
;   D1: PB方向
;   D0: PC低4位方向
;
; 10000000B = 80H
;   D7=1: 方式选择控制字
;   D6-D5=00: A组方式0(基本输入输出)
;   D4=0: PA口输出(控制交通灯)
;   D3=0: PC高4位输出
;   D2=0: B组方式0
;   D1=0: PB口输出
;   D0=0: PC低4位输出
CTRL_8255_INIT  EQU 10000000B

;--------------------- 8253控制字 ---------------------
; 计数器0: 方式3方波发生器,产生1kHz时基
; 00110111B:
;   SC=00: 选择计数器0
;   RW=11: 先读写低字节,再读写高字节(16位)
;   M=011: 方式3(方波发生器)
;   BCD=1: BCD码十进制计数
CTRL_CNT0_MODE3 EQU 00110111B

; 计数器2: 方式0计数结束中断,产生定时
; 10110001B:
;   SC=10: 选择计数器2
;   RW=11: 16位读写
;   M=000: 方式0(计数结束中断)
;   BCD=1: BCD码计数
CTRL_CNT2_MODE0 EQU 10110001B

;============================================================
;              交通灯状态编码定义
;============================================================
;
; PA口位定义:
;   PA5 = 南北绿    PA2 = 东西绿
;   PA4 = 南北黄    PA1 = 东西黄
;   PA3 = 南北红    PA0 = 东西红
;
; 低电平(0)点亮,高电平(1)熄灭
;
;------------------------------------------------------------

; 状态1: 南北绿灯通行,东西红灯等待
; 南北: 绿亮(0) 黄灭(1) 红灭(1) = 011
; 东西: 绿灭(1) 黄灭(1) 红亮(0) = 110
; PA值: 00 011 101 = 35H
;
;   南北方向        东西方向
;   ●绿 ○黄 ○红    ○绿 ○黄 ●红
;   (通行)          (等待)
;
LIGHT_NS_GREEN_EW_RED   EQU 035H

; 状态2: 南北黄灯警示,东西红灯等待
; 南北: 绿灭(1) 黄亮(0) 红灭(1) = 101
; 东西: 绿灭(1) 黄灭(1) 红亮(0) = 110
; PA值: 00 110 011 = 33H
;
;   南北方向        东西方向
;   ○绿 ●黄 ○红    ○绿 ○黄 ●红
;   (警示)          (等待)
;
LIGHT_NS_YELLOW_EW_RED  EQU 033H

; 状态3: 南北灯灭(黄灯闪烁的灭状态),东西红灯
; 南北: 绿灭(1) 黄灭(1) 红灭(1) = 111
; 东西: 绿灭(1) 黄灭(1) 红亮(0) = 110
; PA值: 00 111 110 = 37H (用于黄灯闪烁)
;
LIGHT_NS_OFF_EW_RED     EQU 037H

; 状态4: 南北红灯等待,东西绿灯通行
; 南北: 绿灭(1) 黄灭(1) 红亮(0) = 110
; 东西: 绿亮(0) 黄灭(1) 红灭(1) = 011
; PA值: 00 101 110 = 2EH
;
;   南北方向        东西方向
;   ○绿 ○黄 ●红    ●绿 ○黄 ○红
;   (等待)          (通行)
;
LIGHT_NS_RED_EW_GREEN   EQU 02EH

; 状态5: 南北红灯等待,东西黄灯警示
; 南北: 绿灭(1) 黄灭(1) 红亮(0) = 110
; 东西: 绿灭(1) 黄亮(0) 红灭(1) = 101
; PA值: 00 011 110 = 1EH
;
;   南北方向        东西方向
;   ○绿 ○黄 ●红    ○绿 ●黄 ○红
;   (等待)          (警示)
;
LIGHT_NS_RED_EW_YELLOW  EQU 01EH

; 状态6: 南北红灯,东西灯灭(黄灯闪烁的灭状态)
; PA值: 00 111 110 = 3EH
;
LIGHT_NS_RED_EW_OFF     EQU 03EH

;--------------------- 定时参数 ---------------------
TIME_GREEN      EQU 10          ; 绿灯持续时间: 10秒
TIME_YELLOW     EQU 5           ; 黄灯闪烁次数: 5次(共5秒)

; 计数器初值 (BCD码)
; 1kHz输入时钟, 计数N次 = N毫秒
CNT_1S_LOW      EQU 00H         ; 1000(BCD)的低字节 = 1秒
CNT_1S_HIGH     EQU 10H         ; 1000(BCD)的高字节
CNT_HALF_S_LOW  EQU 00H         ; 500(BCD)的低字节 = 0.5秒
CNT_HALF_S_HIGH EQU 05H         ; 500(BCD)的高字节

;============================================================
; 数据段
;============================================================
.DATA
    ; 延时完成标志
    ; 0 = 正在等待定时完成
    ; 1 = 定时已完成(由NMI中断设置)
    delay_flag  DB 0

;============================================================
; 代码段
;============================================================
.CODE
.STARTUP                        ; 自动生成初始化代码

;============================================================
;                      主程序
;============================================================
; 功能: 系统初始化后进入交通灯控制主循环
; 流程:
;   1. 初始化各硬件模块
;   2. 循环执行四个阶段的交通灯控制
;============================================================
MAIN PROC
    ;----- 初始化数据段寄存器 -----
    MOV AX, @DATA               ; 获取数据段地址
    MOV DS, AX                  ; DS指向数据段
                                ; 这样才能访问delay_flag变量

    ;----- 系统初始化 -----
    CALL INIT_NMI               ; 设置NMI中断向量
    CALL INIT_8255              ; 初始化8255并行接口
    CALL INIT_8253_CNT0         ; 初始化8253时基发生器

;============================================================
;              交通灯控制主循环
;============================================================
; 无限循环执行以下四个阶段:
;   阶段1: 南北绿灯(10秒)
;   阶段2: 南北黄灯闪烁(5秒)
;   阶段3: 东西绿灯(10秒)
;   阶段4: 东西黄灯闪烁(5秒)
;============================================================
MAIN_LOOP:

;--------------- 阶段1: 南北绿灯通行 ---------------
; 南北方向: 绿灯亮,车辆可通行
; 东西方向: 红灯亮,车辆需等待
; 持续时间: 10秒
;
    MOV AL, LIGHT_NS_GREEN_EW_RED   ; AL = 35H
    CALL SET_LIGHT                  ; 设置灯状态
    MOV CX, TIME_GREEN              ; CX = 10 (延时10秒)
    CALL DELAY_SECONDS              ; 调用延时子程序

;--------------- 阶段2: 南北黄灯闪烁 ---------------
; 南北方向: 黄灯闪烁,警示即将变红
; 东西方向: 红灯保持
; 闪烁次数: 5次 (亮0.5秒+灭0.5秒 = 1秒/次, 共5秒)
;
    MOV CX, TIME_YELLOW             ; CX = 5 (闪烁5次)
NS_YELLOW_BLINK:
    PUSH CX                         ; 保存循环计数(CALL会用到CX)

    ; 黄灯亮
    MOV AL, LIGHT_NS_YELLOW_EW_RED  ; AL = 33H
    CALL SET_LIGHT
    CALL DELAY_HALF_SECOND          ; 延时0.5秒

    ; 黄灯灭
    MOV AL, LIGHT_NS_OFF_EW_RED     ; AL = 37H
    CALL SET_LIGHT
    CALL DELAY_HALF_SECOND          ; 延时0.5秒

    POP CX                          ; 恢复循环计数
    LOOP NS_YELLOW_BLINK            ; CX-1,不为0则继续闪烁

;--------------- 阶段3: 东西绿灯通行 ---------------
; 南北方向: 红灯亮,车辆需等待
; 东西方向: 绿灯亮,车辆可通行
; 持续时间: 10秒
;
    MOV AL, LIGHT_NS_RED_EW_GREEN   ; AL = 2EH
    CALL SET_LIGHT
    MOV CX, TIME_GREEN              ; CX = 10
    CALL DELAY_SECONDS              ; 延时10秒

;--------------- 阶段4: 东西黄灯闪烁 ---------------
; 南北方向: 红灯保持
; 东西方向: 黄灯闪烁,警示即将变红
; 闪烁次数: 5次
;
    MOV CX, TIME_YELLOW             ; CX = 5
EW_YELLOW_BLINK:
    PUSH CX

    ; 黄灯亮
    MOV AL, LIGHT_NS_RED_EW_YELLOW  ; AL = 1EH
    CALL SET_LIGHT
    CALL DELAY_HALF_SECOND

    ; 黄灯灭
    MOV AL, LIGHT_NS_RED_EW_OFF     ; AL = 3EH
    CALL SET_LIGHT
    CALL DELAY_HALF_SECOND

    POP CX
    LOOP EW_YELLOW_BLINK

    ;----- 返回阶段1,无限循环 -----
    JMP MAIN_LOOP

MAIN ENDP

;============================================================
;              子程序: INIT_NMI
;============================================================
; 功能: 设置NMI(不可屏蔽中断)的中断向量
;
; NMI中断说明:
;   - 中断类型号: 2
;   - 向量地址: 2 × 4 = 8 (即0000:0008H)
;   - 特点: 不能被CLI指令屏蔽
;
; 中断向量表内存布局:
;   0000:0008  存放中断服务程序的偏移地址(IP)
;   0000:000A  存放中断服务程序的段地址(CS)
;============================================================
INIT_NMI PROC
    PUSH ES                     ; 保护ES寄存器
    PUSH AX                     ; 保护AX寄存器

    XOR AX, AX                  ; AX = 0
    MOV ES, AX                  ; ES = 0000H
                                ; ES指向内存最低端(中断向量表)

    ; 设置中断向量的偏移地址
    MOV AX, OFFSET NMI_ISR      ; 获取NMI_ISR的偏移地址
    MOV ES:[08H], AX            ; 写入0000:0008

    ; 设置中断向量的段地址
    MOV AX, SEG NMI_ISR         ; 获取NMI_ISR的段地址
    MOV ES:[0AH], AX            ; 写入0000:000A

    POP AX                      ; 恢复AX
    POP ES                      ; 恢复ES
    RET
INIT_NMI ENDP

;============================================================
;              子程序: INIT_8255
;============================================================
; 功能: 初始化8255可编程并行接口
; 设置: PA口为输出模式,用于驱动交通灯LED
;
; 8255控制字 = 80H:
;   - 工作方式0(基本输入输出)
;   - PA口输出
;   - PB口输出
;   - PC口输出
;============================================================
INIT_8255 PROC
    MOV DX, PORT_8255_CTRL      ; DX = 206H (控制字寄存器)
    MOV AL, CTRL_8255_INIT      ; AL = 80H
    OUT DX, AL                  ; 写入控制字
                                ; 8255初始化完成
    RET
INIT_8255 ENDP

;============================================================
;              子程序: INIT_8253_CNT0
;============================================================
; 功能: 初始化8253计数器0,产生1kHz时基信号
;
; 配置:
;   - 方式3: 方波发生器
;   - 16位计数
;   - BCD码
;   - 初值: 100
;
; 计算:
;   假设输入时钟 = 100kHz
;   输出频率 = 100kHz ÷ 100 = 1kHz
;   输出周期 = 1ms
;
; 输出信号连接到计数器2的CLK输入
;============================================================
INIT_8253_CNT0 PROC
    ; 写入控制字
    MOV DX, PORT_8253_CTRL      ; DX = 406H
    MOV AL, CTRL_CNT0_MODE3     ; AL = 37H (计数器0,方式3,BCD)
    OUT DX, AL

    ; 写入计数初值100(BCD) = 0100
    ; 必须先写低字节,再写高字节
    MOV DX, PORT_8253_CNT0      ; DX = 400H
    MOV AL, 00H                 ; 低字节 = 00
    OUT DX, AL
    MOV AL, 01H                 ; 高字节 = 01
    OUT DX, AL
                                ; 计数器0开始产生1kHz方波
    RET
INIT_8253_CNT0 ENDP

;============================================================
;              子程序: SET_LIGHT
;============================================================
; 功能: 设置交通灯显示状态
; 入口参数: AL = 灯状态控制字
; 出口参数: 无
;
; 使用方法:
;   MOV AL, 灯状态值
;   CALL SET_LIGHT
;============================================================
SET_LIGHT PROC
    PUSH DX                     ; 保护DX
    MOV DX, PORT_8255_PA        ; DX = 200H (PA口)
    OUT DX, AL                  ; 输出灯状态到PA口
    POP DX                      ; 恢复DX
    RET
SET_LIGHT ENDP

;============================================================
;              子程序: DELAY_SECONDS
;============================================================
; 功能: 延时指定秒数
; 入口参数: CX = 延时秒数
; 出口参数: 无
;
; 实现原理:
;   1. 配置8253计数器2为方式0
;   2. 写入计数初值1000(BCD),实现1秒定时
;   3. 等待NMI中断设置delay_flag=1
;   4. 重复CX次
;
; 调用示例:
;   MOV CX, 10          ; 延时10秒
;   CALL DELAY_SECONDS
;============================================================
DELAY_SECONDS PROC
    PUSH AX                     ; 保护寄存器
    PUSH DX
    PUSH CX

DELAY_SEC_LOOP:
    PUSH CX                     ; 保存外层循环计数

    ;----- 配置计数器2: 方式0,1秒定时 -----
    MOV DX, PORT_8253_CTRL      ; DX = 406H
    MOV AL, CTRL_CNT2_MODE0     ; AL = B1H
    OUT DX, AL                  ; 写入控制字

    ;----- 写入计数初值1000(BCD) -----
    MOV DX, PORT_8253_CNT2      ; DX = 404H
    MOV AL, CNT_1S_LOW          ; AL = 00H (低字节)
    OUT DX, AL
    MOV AL, CNT_1S_HIGH         ; AL = 10H (高字节)
    OUT DX, AL
                                ; 计数器2开始计数
                                ; 1000ms后触发NMI中断

    ;----- 等待定时完成 -----
    MOV delay_flag, 0           ; 清除标志
WAIT_1S:
    CMP delay_flag, 1           ; 检查标志是否被设置
    JNE WAIT_1S                 ; 未设置则继续等待
                                ; NMI中断会设置delay_flag=1

    POP CX                      ; 恢复外层循环计数
    LOOP DELAY_SEC_LOOP         ; CX-1,不为0则继续

    POP CX                      ; 恢复寄存器
    POP DX
    POP AX
    RET
DELAY_SECONDS ENDP

;============================================================
;              子程序: DELAY_HALF_SECOND
;============================================================
; 功能: 延时0.5秒,用于黄灯闪烁效果
; 入口参数: 无
; 出口参数: 无
;
; 实现原理:
;   配置计数器2初值为500(BCD)
;   1kHz输入,计数500次 = 500ms = 0.5秒
;============================================================
DELAY_HALF_SECOND PROC
    PUSH AX                     ; 保护寄存器
    PUSH DX

    ;----- 配置计数器2: 方式0,0.5秒定时 -----
    MOV DX, PORT_8253_CTRL
    MOV AL, CTRL_CNT2_MODE0
    OUT DX, AL

    ;----- 写入计数初值500(BCD) -----
    MOV DX, PORT_8253_CNT2
    MOV AL, CNT_HALF_S_LOW      ; AL = 00H
    OUT DX, AL
    MOV AL, CNT_HALF_S_HIGH     ; AL = 05H
    OUT DX, AL
                                ; 计数器2开始计数
                                ; 500ms后触发NMI中断

    ;----- 等待定时完成 -----
    MOV delay_flag, 0           ; 清除标志
WAIT_HALF:
    CMP delay_flag, 1           ; 检查标志
    JNE WAIT_HALF               ; 等待NMI设置标志

    POP DX                      ; 恢复寄存器
    POP AX
    RET
DELAY_HALF_SECOND ENDP

;============================================================
;              中断服务程序: NMI_ISR
;============================================================
; 功能: 处理NMI中断,设置延时完成标志
;
; 触发条件:
;   8253计数器2计数到0时,OUT2输出高电平
;   通过硬件连接触发CPU的NMI引脚
;
; 处理过程:
;   1. 保护现场(AX, DS)
;   2. 设置DS指向数据段
;   3. 将delay_flag设为1
;   4. 恢复现场
;   5. IRET返回
;
; 注意:
;   中断服务程序必须保护所有使用的寄存器!
;   否则会破坏被中断程序的执行环境
;============================================================
NMI_ISR PROC
    PUSH AX                     ; 保护AX
    PUSH DS                     ; 保护DS

    ;----- 设置数据段 -----
    ; 中断可能在任何时候发生
    ; 此时DS可能不是我们的数据段
    ; 必须重新设置才能访问delay_flag
    MOV AX, @DATA
    MOV DS, AX

    ;----- 设置延时完成标志 -----
    MOV delay_flag, 1           ; 告诉主程序定时已完成

    POP DS                      ; 恢复DS
    POP AX                      ; 恢复AX
    IRET                        ; 中断返回
                                ; 自动恢复IP、CS、FLAGS
NMI_ISR ENDP

;============================================================
; 程序结束
;============================================================
END

;============================================================
;                    程序执行流程图
;============================================================
;
;   ┌─────────────────────────────────┐
;   │         程序启动                │
;   └───────────────┬─────────────────┘
;                   ↓
;   ┌─────────────────────────────────┐
;   │ 初始化:                         │
;   │ · INIT_NMI (设置中断向量)       │
;   │ · INIT_8255 (PA口输出)          │
;   │ · INIT_8253_CNT0 (1kHz时基)     │
;   └───────────────┬─────────────────┘
;                   ↓
;   ┌─────────────────────────────────┐
;   │ 阶段1: 南北绿灯 10秒            │←─────────┐
;   │  ●绿 ○黄 ○红 | ○绿 ○黄 ●红    │          │
;   └───────────────┬─────────────────┘          │
;                   ↓                            │
;   ┌─────────────────────────────────┐          │
;   │ 阶段2: 南北黄灯闪烁 5次         │          │
;   │  ○绿 ◐黄 ○红 | ○绿 ○黄 ●红    │          │
;   │  (◐表示闪烁)                    │          │
;   └───────────────┬─────────────────┘          │
;                   ↓                            │
;   ┌─────────────────────────────────┐          │
;   │ 阶段3: 东西绿灯 10秒            │          │
;   │  ○绿 ○黄 ●红 | ●绿 ○黄 ○红    │          │
;   └───────────────┬─────────────────┘          │
;                   ↓                            │
;   ┌─────────────────────────────────┐          │
;   │ 阶段4: 东西黄灯闪烁 5次         │          │
;   │  ○绿 ○黄 ●红 | ○绿 ◐黄 ○红    │          │
;   └───────────────┬─────────────────┘          │
;                   │                            │
;                   └────────────────────────────┘
;                        (无限循环)
;
;============================================================
;                    定时系统工作原理
;============================================================
;
;   ┌──────────────────────────────────────────────┐
;   │                   主程序                     │
;   │                                              │
;   │   delay_flag = 0  ←─── 清除标志             │
;   │         ↓                                    │
;   │   ┌──────────┐                               │
;   │   │等待循环  │←──┐                          │
;   │   │检查标志  │   │                          │
;   │   └────┬─────┘   │                          │
;   │        ↓         │                          │
;   │   flag=1? ──否───┘                          │
;   │        │是                                   │
;   │        ↓                                    │
;   │   定时完成,继续执行                          │
;   └──────────────────────────────────────────────┘
;
;                    ↑ 设置flag=1
;                    │
;   ┌──────────────────────────────────────────────┐
;   │              NMI中断服务程序                  │
;   │                                              │
;   │   8253计数器2计数到0 → 触发NMI              │
;   │                ↓                             │
;   │   CPU响应中断,跳转到NMI_ISR                  │
;   │                ↓                             │
;   │   设置 delay_flag = 1                        │
;   │                ↓                             │
;   │   IRET返回主程序                             │
;   └──────────────────────────────────────────────┘
;
;============================================================
;                    硬件连接示意图
;============================================================
;
;                    ┌─────────────┐
;   100kHz时钟 ────→│ 8253计数器0 │──→ 1kHz方波
;                    │   方式3     │
;                    │   ÷100      │
;                    └─────────────┘
;                           │
;                           ↓ CLK2
;                    ┌─────────────┐
;                    │ 8253计数器2 │──→ OUT2 ──→ NMI
;                    │   方式0     │
;                    │ ÷1000或÷500│
;                    └─────────────┘
;
;                    ┌─────────────┐
;                    │    8255     │
;                    │             │
;                    │ PA5 ──→ 南北绿灯
;                    │ PA4 ──→ 南北黄灯
;                    │ PA3 ──→ 南北红灯
;                    │ PA2 ──→ 东西绿灯
;                    │ PA1 ──→ 东西黄灯
;                    │ PA0 ──→ 东西红灯
;                    └─────────────┘
;
;============================================================
