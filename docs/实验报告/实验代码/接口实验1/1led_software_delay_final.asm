;============================================================
; 软件延时流水灯程序 - 8086汇编
;
; 硬件配置:
;   - 74LS273锁存器 (端口地址: 200H)
;   - 16个LED连接至锁存器输出端 (低电平点亮)
;
; 功能描述:
;   实现16位LED循环流水效果
;   通过LOOP指令实现延时控制流水速度
;   LED依次从右向左点亮,循环往复
;
; 工作原理:
;   1. 初始状态: 最右侧LED点亮 (AX = 0FFFEH)
;   2. 每次循环将AX左移一位
;   3. 通过LOOP $指令消耗CPU周期实现延时
;   4. 无限循环实现持续流水效果
;
; 作者: [你的姓名]
; 日期: [日期]
;============================================================

;============================================================
;                 基础知识说明
;============================================================
;
; 【74LS273芯片】
;   74LS273是8位D触发器(锁存器)
;   本实验使用两片级联,实现16位输出
;   OUT指令输出时,数据被锁存并驱动LED
;
; 【LED显示原理】
;   低电平点亮: 输出0时LED亮,输出1时LED灭
;   16位数据对应16个LED
;   例如: 0FFFEH = 1111 1111 1111 1110
;         最低位为0,所以LED0点亮
;
; 【ROL循环左移指令】
;   ROL AX,1 将AX所有位左移1位
;   最高位移出后填入最低位(循环)
;   例如: 1111 1111 1111 1110 (0FFFEH)
;     →   1111 1111 1111 1101 (0FFFDH)
;   那个"0"从bit0移动到了bit1
;
; 【LOOP $延时原理】
;   LOOP指令: CX = CX - 1,若CX≠0则跳转
;   $表示当前指令地址,即跳转到自身
;   效果: 循环执行直到CX减为0
;   CX初值来自前面的OUT指令后的残留值
;   每次LOOP消耗约17个时钟周期
;
;============================================================

CODE    SEGMENT PUBLIC 'CODE'
        ASSUME CS:CODE

START:
;------------------------------------------------------------
; 主程序入口
;------------------------------------------------------------

;--------------- 初始化LED状态 ---------------
        MOV DX, 0200H           ; DX = 200H,设置I/O端口地址
                                ; 200H是74LS273锁存器的端口地址

        MOV AX, 0FFFFH          ; AX = FFFFH = 1111 1111 1111 1111
                                ; 全为1,所有LED熄灭(低电平点亮)

        OUT DX, AX              ; 将AX输出到端口,熄灭所有LED
                                ; 这是初始化,确保开始时LED全灭

        MOV AX, 0FFFEH          ; AX = FFFEH = 1111 1111 1111 1110
                                ; 最低位为0,准备点亮LED0

;--------------- 流水灯主循环 ---------------
AGAIN:
        ROL AX, 1               ; AX循环左移1位
                                ; 第1次: FFFEH→FFFDH,LED1亮
                                ; 第2次: FFFDH→FFFBH,LED2亮
                                ; 第3次: FFFBH→FFF7H,LED3亮
                                ; ...依此类推
                                ; 第16次后回到FFFEH,LED0亮

        OUT DX, AX              ; 将AX输出到74LS273锁存器
                                ; LED显示状态随之改变
                                ; 哪一位是0,对应的LED就亮

        LOOP $                  ; 延时循环1
                                ; $表示当前地址,即跳转到自身
                                ; CX不断减1直到为0才退出
                                ; 实现软件延时效果

        LOOP $                  ; 延时循环2
                                ; 两次LOOP $延时更长
                                ; 让LED状态保持足够时间
                                ; 便于人眼观察流水效果

        JMP AGAIN               ; 无条件跳转回AGAIN标签
                                ; 形成无限循环
                                ; 程序永不停止,持续流水

;--------------- 以下代码不会执行 ---------------
        MOV AH, 4CH             ; DOS结束程序功能号
        INT 21H                 ; 调用DOS中断(实际不会执行到)

ENDLESS:
        JMP ENDLESS             ; 死循环(实际不会执行到)

CODE    ENDS
        END START

;============================================================
;                    程序执行流程
;============================================================
;
;   ┌─────────────────────┐
;   │ 初始化: AX=0FFFEH   │
;   │ 熄灭所有LED         │
;   └──────────┬──────────┘
;              ↓
;   ┌─────────────────────┐
;   │ ROL AX,1 循环左移   │←────┐
;   └──────────┬──────────┘     │
;              ↓                │
;   ┌─────────────────────┐     │
;   │ OUT DX,AX 输出显示  │     │
;   └──────────┬──────────┘     │
;              ↓                │
;   ┌─────────────────────┐     │
;   │ LOOP $ 延时         │     │
;   │ LOOP $ 延时         │     │
;   └──────────┬──────────┘     │
;              ↓                │
;   ┌─────────────────────┐     │
;   │ JMP AGAIN           │─────┘
;   └─────────────────────┘
;
;============================================================
;                  LED状态变化示意
;============================================================
;
;   循环次数    AX值      二进制表示              点亮LED
;   ─────────────────────────────────────────────────────
;   初始      0FFFEH    1111 1111 1111 1110      LED0
;   第1次     0FFFDH    1111 1111 1111 1101      LED1
;   第2次     0FFFBH    1111 1111 1111 1011      LED2
;   第3次     0FFF7H    1111 1111 1111 0111      LED3
;   第4次     0FFEFH    1111 1111 1110 1111      LED4
;   第5次     0FFDFH    1111 1111 1101 1111      LED5
;   第6次     0FFBFH    1111 1111 1011 1111      LED6
;   第7次     0FF7FH    1111 1111 0111 1111      LED7
;   第8次     0FEFFH    1111 1110 1111 1111      LED8
;   第9次     0FDFFH    1111 1101 1111 1111      LED9
;   第10次    0FBFFH    1111 1011 1111 1111      LED10
;   第11次    0F7FFH    1111 0111 1111 1111      LED11
;   第12次    0EFFFH    1110 1111 1111 1111      LED12
;   第13次    0DFFFH    1101 1111 1111 1111      LED13
;   第14次    0BFFFH    1011 1111 1111 1111      LED14
;   第15次    07FFFH    0111 1111 1111 1111      LED15
;   第16次    0FFFEH    1111 1111 1111 1110      LED0 (循环)
;
;============================================================
