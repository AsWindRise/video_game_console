;============================================================
; 按键控制LED程序 - 8086汇编
;
; 硬件配置:
;   - 8255可编程并行接口芯片 (基址: 200H)
;   - PA口 (端口A): 连接8个按键开关 (作为输入)
;   - PB口 (端口B): 连接8个LED发光二极管 (作为输出)
;
; 功能描述:
;   读取PA口的按键状态,直接输出到PB口控制LED
;   实现"按哪个键亮哪个灯"的效果
;   按键按下对应LED点亮,松开则熄灭
;
; 作者: [你的姓名]
; 日期: [日期]
;============================================================

;============================================================
;                    8255芯片基础知识
;============================================================
;
; 【什么是8255】
;   8255是可编程并行接口芯片,有3个8位端口(PA、PB、PC)
;   可以灵活配置每个端口为输入或输出模式
;   是单片机/微机系统中最常用的I/O扩展芯片
;
; 【8255端口地址】
;   本实验中8255基地址为200H
;   PA口地址 = 基址 + 0 = 200H  (A1A0=00)
;   PB口地址 = 基址 + 2 = 202H  (A1A0=01)
;   PC口地址 = 基址 + 4 = 204H  (A1A0=10)
;   控制字地址 = 基址 + 6 = 206H  (A1A0=11)
;
; 【8255控制字格式】(方式选择控制字)
;   D7: 1 = 方式选择控制字 (必须为1)
;   D6-D5: A组方式选择 (00=方式0, 01=方式1, 1X=方式2)
;   D4: PA口方向 (0=输出, 1=输入)
;   D3: PC高4位方向 (0=输出, 1=输入)
;   D2: B组方式选择 (0=方式0, 1=方式1)
;   D1: PB口方向 (0=输出, 1=输入)
;   D0: PC低4位方向 (0=输出, 1=输入)
;
;============================================================

;============================================================
; 常量定义
;============================================================

; 8255端口地址
PORT_8255_PA    EQU 200H        ; PA口地址 - 连接按键
PORT_8255_PB    EQU 202H        ; PB口地址 - 连接LED
PORT_8255_PC    EQU 204H        ; PC口地址 - 本程序未使用
PORT_8255_CTRL  EQU 206H        ; 控制字寄存器地址

; 8255控制字
; 我们需要: PA输入(读按键), PB输出(控制LED)
;
; 控制字 = 1001 0000B = 90H
;   D7 = 1: 方式选择控制字
;   D6-D5 = 00: A组工作在方式0 (基本输入输出)
;   D4 = 1: PA口设为输入模式 (读取按键)
;   D3 = 0: PC高4位输出
;   D2 = 0: B组工作在方式0
;   D1 = 0: PB口设为输出模式 (控制LED)
;   D0 = 0: PC低4位输出
;
CTRL_8255_INIT  EQU 10010000B   ; 即90H

;============================================================
; 代码段
;============================================================
CODE    SEGMENT PUBLIC 'CODE'
        ASSUME CS:CODE

START:
;------------------------------------------------------------
; 主程序入口
;------------------------------------------------------------

;--------------- 初始化8255 ---------------
; 功能: 配置8255工作模式
;       PA口 = 输入 (连接按键)
;       PB口 = 输出 (连接LED)
INIT_8255:
        MOV DX, PORT_8255_CTRL  ; DX = 206H (控制字寄存器地址)
        MOV AL, CTRL_8255_INIT  ; AL = 90H (控制字)
        OUT DX, AL              ; 将控制字写入8255
                                ; 此时8255完成初始化:
                                ; PA口变为输入模式
                                ; PB口变为输出模式

;--------------- 按键检测与LED控制主循环 ---------------
; 功能: 不断读取按键状态,并输出到LED
; 原理:
;   按键按下 → PA口对应位变为0 → 输出到PB → LED点亮
;   按键松开 → PA口对应位变为1 → 输出到PB → LED熄灭
MAIN_LOOP:
        ; 第一步: 从PA口读取按键状态
        MOV DX, PORT_8255_PA    ; DX = 200H (PA口地址)
        IN AL, DX               ; 从PA口读取数据到AL
                                ; AL中每一位对应一个按键:
                                ; 按键按下 = 0, 按键松开 = 1

        ; 第二步: 将按键状态输出到PB口控制LED
        MOV DX, PORT_8255_PB    ; DX = 202H (PB口地址)
        OUT DX, AL              ; 将AL输出到PB口
                                ; PB口每一位对应一个LED:
                                ; 输出0 = LED亮, 输出1 = LED灭

        ; 第三步: 跳回循环开始,持续检测
        JMP MAIN_LOOP           ; 无条件跳转,形成无限循环
                                ; 程序会一直在这个循环中运行
                                ; 实时响应按键操作

CODE    ENDS
        END START

;============================================================
;                      程序流程图
;============================================================
;
;   ┌─────────────────┐
;   │   程序开始      │
;   └────────┬────────┘
;            ↓
;   ┌─────────────────┐
;   │ 初始化8255      │
;   │ PA=输入,PB=输出 │
;   └────────┬────────┘
;            ↓
;   ┌─────────────────┐
;   │ 从PA口读按键    │←──────┐
;   └────────┬────────┘       │
;            ↓                │
;   ┌─────────────────┐       │
;   │ 输出到PB口LED   │       │
;   └────────┬────────┘       │
;            │                │
;            └────────────────┘
;          (无限循环)
;
;============================================================
