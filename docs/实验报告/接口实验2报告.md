# 实验报告单

**实验名称：** 4. 可编程接口芯片8255应用实验

**实验室：** 产教融合大楼A301/通识机房508
**时间：** 2025.11.20

---

## 实验项目

### 一、实验目的

1. 掌握8255可编程并行接口芯片的工作原理和使用方法；
2. 学会8255的初始化编程方法，正确设置控制字；
3. 掌握8255方式0的输入输出编程方法；
4. 理解动态扫描显示的原理和实现方法；
5. 掌握按键输入检测和消抖处理的方法。

---

### 二、8255端口地址

本实验中8255基地址为200H，各端口地址如下：

| 端口     | 地址  | 功能说明           |
|----------|-------|-------------------|
| PA口     | 200H  | A组端口           |
| PB口     | 202H  | B组端口           |
| PC口     | 204H  | C组端口           |
| 控制字   | 206H  | 控制寄存器         |

---

### 三、实验步骤

#### 实验一：按键控制LED

1. 在Proteus中搭建硬件电路（8086、8255、按键、LED等）
2. 配置8255：PA口输入（按键），PB口输出（LED）
3. 编写程序：读取PA口按键状态，输出到PB口控制LED
4. 编译并启动仿真，测试按键功能

#### 实验二：数码管动态扫描显示

1. 在Proteus中搭建硬件电路（8086、8255、8位数码管、按键等）
2. 配置8255：PA口输出（段选），PB口输出（位选），PC口输入（按键）
3. 编写程序：动态扫描显示0-7，按键控制循环左移
4. 编译并启动仿真，测试显示和按键功能

---

### 四、实验代码

#### 实验一代码：按键控制LED

```assembly
;============================================================
; 按键控制LED程序 - 8086汇编
;
; 硬件配置:
;   - 8255可编程并行接口芯片 (基址: 200H)
;   - PA口 (端口A): 连接8个按键开关 (作为输入)
;   - PB口 (端口B): 连接8个LED发光二极管 (作为输出)
;
; 功能描述:
;   读取PA口的按键状态,直接输出到PB口控制LED
;   实现"按哪个键亮哪个灯"的效果
;============================================================

;============================================================
; 常量定义
;============================================================

; 8255端口地址
PORT_8255_PA    EQU 200H        ; PA口地址 - 连接按键
PORT_8255_PB    EQU 202H        ; PB口地址 - 连接LED
PORT_8255_PC    EQU 204H        ; PC口地址 - 本程序未使用
PORT_8255_CTRL  EQU 206H        ; 控制字寄存器地址

; 8255控制字
; 控制字 = 1001 0000B = 90H
;   D7 = 1: 方式选择控制字
;   D6-D5 = 00: A组工作在方式0
;   D4 = 1: PA口设为输入模式 (读取按键)
;   D3 = 0: PC高4位输出
;   D2 = 0: B组工作在方式0
;   D1 = 0: PB口设为输出模式 (控制LED)
;   D0 = 0: PC低4位输出
CTRL_8255_INIT  EQU 10010000B   ; 即90H

;============================================================
; 代码段
;============================================================
CODE    SEGMENT PUBLIC 'CODE'
        ASSUME CS:CODE

START:
;------------------------------------------------------------
; 主程序入口
;------------------------------------------------------------

;--------------- 初始化8255 ---------------
INIT_8255:
        MOV DX, PORT_8255_CTRL  ; DX = 206H (控制字寄存器地址)
        MOV AL, CTRL_8255_INIT  ; AL = 90H (控制字)
        OUT DX, AL              ; 将控制字写入8255
                                ; PA口变为输入模式
                                ; PB口变为输出模式

;--------------- 按键检测与LED控制主循环 ---------------
MAIN_LOOP:
        ; 第一步: 从PA口读取按键状态
        MOV DX, PORT_8255_PA    ; DX = 200H (PA口地址)
        IN AL, DX               ; 从PA口读取数据到AL
                                ; 按键按下 = 0, 按键松开 = 1

        ; 第二步: 将按键状态输出到PB口控制LED
        MOV DX, PORT_8255_PB    ; DX = 202H (PB口地址)
        OUT DX, AL              ; 将AL输出到PB口
                                ; 输出0 = LED亮, 输出1 = LED灭

        ; 第三步: 跳回循环开始,持续检测
        JMP MAIN_LOOP           ; 无条件跳转,形成无限循环

CODE    ENDS
        END START
```

---

#### 实验二代码：数码管动态扫描显示

```assembly
;============================================================
; 八位数码管动态扫描显示程序 - 8086汇编
;
; 硬件配置:
;   - 8255可编程并行接口芯片 (基址: 200H)
;   - PA口: 连接数码管段选信号 (a-g + dp)
;   - PB口: 连接数码管位选信号 (8位,控制哪个数码管亮)
;   - PC口: 连接按键输入
;   - 8个共阴极七段数码管
;
; 功能描述:
;   1. 动态扫描显示数字76543210
;   2. 按下按键后,显示内容循环左移
;      例如: 76543210 → 65432107 → 54321076 → ...
;============================================================

.MODEL SMALL
.8086
.STACK 256

;============================================================
; 数据段
;============================================================
.DATA

; 数码管段选码表 (共阴极)
; 存储顺序: 数字7,6,5,4,3,2,1,0 (对应显示位置从左到右)
BUF DB 007H     ; 数字7的段选码: 0000 0111
    DB 07DH     ; 数字6的段选码: 0111 1101
    DB 06DH     ; 数字5的段选码: 0110 1101
    DB 066H     ; 数字4的段选码: 0110 0110
    DB 04FH     ; 数字3的段选码: 0100 1111
    DB 05BH     ; 数字2的段选码: 0101 1011
    DB 006H     ; 数字1的段选码: 0000 0110
    DB 03FH     ; 数字0的段选码: 0011 1111

;============================================================
; 常量定义
;============================================================

; 8255端口地址
PORT_8255_PA    EQU 200H        ; PA口 - 段选输出
PORT_8255_PB    EQU 202H        ; PB口 - 位选输出
PORT_8255_PC    EQU 204H        ; PC口 - 按键输入
PORT_8255_CTRL  EQU 206H        ; 控制字寄存器

; 8255控制字
; 控制字 = 1000 1001B = 89H
;   D7 = 1: 方式选择控制字
;   D6-D5 = 00: A组方式0
;   D4 = 0: PA口输出 (段选)
;   D3 = 0: PC高4位输出
;   D2 = 0: B组方式0
;   D1 = 0: PB口输出 (位选)
;   D0 = 1: PC低4位输入 (按键)
CTRL_8255_INIT  EQU 10001001B   ; 89H

; 显示参数
DIGIT_COUNT     EQU 8           ; 数码管数量
DELAY_COUNT     EQU 66H         ; 延时计数值 (控制扫描速度)

; 位选初始值
; 0111 1111 = 7FH,最高位为0,选中最左边的数码管
BIT_SELECT_INIT EQU 7FH

; 按键检测值
; 0xFE = 1111 1110,表示PC0按键被按下
KEY_PRESSED     EQU 0FEH

;============================================================
; 代码段
;============================================================
.CODE
.STARTUP

;------------------------------------------------------------
; 主程序入口
;------------------------------------------------------------
START:

;--------------- 初始化8255 ---------------
INIT_8255:
        MOV DX, PORT_8255_CTRL  ; 控制字寄存器地址
        MOV AL, CTRL_8255_INIT  ; 控制字89H
        OUT DX, AL              ; 写入控制字,完成8255初始化

;============================================================
;               主循环 - 动态扫描显示
;============================================================
MAIN_LOOP:
        MOV CX, DIGIT_COUNT     ; CX = 8,循环8次扫描8个数码管
        MOV AH, BIT_SELECT_INIT ; AH = 7FH = 0111 1111
                                ; 位选信号,最高位为0表示选中第1个数码管
        MOV BX, OFFSET BUF      ; BX指向段选码数组首地址

;--------------- 扫描循环 - 逐个点亮数码管 ---------------
SCAN_LOOP:
        ; 步骤1: 输出位选信号,选中当前数码管
        MOV DX, PORT_8255_PB    ; PB口地址
        MOV AL, AH              ; AL = 当前位选值
        OUT DX, AL              ; 输出位选,选中对应的数码管

        ; 步骤2: 输出段选信号,显示对应数字
        MOV DX, PORT_8255_PA    ; PA口地址
        MOV AL, [BX]            ; AL = 当前数字的段选码
        OUT DX, AL              ; 输出段选,点亮对应的段

        ; 步骤3: 延时,让当前数码管保持显示一段时间
        MOV DX, CX              ; 保存CX (因为LOOP要用CX)
        MOV CX, DELAY_COUNT     ; 设置延时循环次数
DELAY_LOOP:
        LOOP DELAY_LOOP         ; 空循环延时
        MOV CX, DX              ; 恢复CX

        ; 步骤4: 准备扫描下一个数码管
        INC BX                  ; BX指向下一个段选码
        ROR AH, 1               ; 位选右移一位
                                ; 依次选中从左到右的数码管

        LOOP SCAN_LOOP          ; CX减1,继续扫描下一个数码管

;--------------- 按键检测 ---------------
CHECK_KEY:
        MOV DX, PORT_8255_PC    ; PC口地址
        IN AL, DX               ; 读取按键状态
        CMP AL, KEY_PRESSED     ; 比较是否等于0xFE (按键按下)
        JZ KEY_DEBOUNCE         ; 相等则跳转到消抖处理
        JMP MAIN_LOOP           ; 没按下,继续扫描显示

;--------------- 按键消抖处理 ---------------
KEY_DEBOUNCE:
        MOV DX, PORT_8255_PC    ; PC口地址
        IN AL, DX               ; 读取按键状态
        CMP AL, KEY_PRESSED     ; 判断按键是否仍然按下
        JZ KEY_DEBOUNCE         ; 还在按着就继续等待

;============================================================
;           数据左移处理 - 循环移位显示内容
;============================================================
SHIFT_LEFT:
        MOV BX, OFFSET BUF      ; BX指向数组首地址
        MOV CX, 7               ; 循环7次 (移动7个元素)
        MOV AL, [BX]            ; 保存第一个元素到AL

SHIFT_LOOP:
        MOV AH, [BX+1]          ; 取下一个元素
        MOV [BX], AH            ; 放到当前位置 (前移)
        INC BX                  ; 指针后移
        LOOP SHIFT_LOOP         ; 循环直到移完7个

        MOV [BX], AL            ; 把保存的第一个元素放到最后

        JMP MAIN_LOOP           ; 返回主循环,继续扫描显示

EXIT:
        MOV AX, 4C00H
        INT 21H

        END START
```

---

### 五、实验结果与数据记录

#### 实验一：按键控制LED

**测试记录：**

| 按键状态          | PA口读取值（二进制）      | PB口输出值      | LED状态       |
|-------------------|--------------------------|----------------|--------------|
| 无按键按下        | 1111 1111                | 1111 1111      | 全部熄灭     |
| 按下KEY0          | 1111 1110                | 1111 1110      | LED0点亮     |
| 按下KEY1          | 1111 1101                | 1111 1101      | LED1点亮     |
| 按下KEY0+KEY1     | 1111 1100                | 1111 1100      | LED0+LED1亮  |
| 按下KEY7          | 0111 1111                | 0111 1111      | LED7点亮     |
| 同时按下所有按键   | 0000 0000                | 0000 0000      | 全部点亮     |

---

#### 实验二：数码管动态扫描显示

**初始显示状态：**

| 数码管位置 | 位选信号 | 显示数字 | 段选码（十六进制）|
|-----------|---------|---------|------------------|
| 第1位     | 7FH     | 7       | 07H              |
| 第2位     | BFH     | 6       | 7DH              |
| 第3位     | DFH     | 5       | 6DH              |
| 第4位     | EFH     | 4       | 66H              |
| 第5位     | F7H     | 3       | 4FH              |
| 第6位     | FBH     | 2       | 5BH              |
| 第7位     | FDH     | 1       | 06H              |
| 第8位     | FEH     | 0       | 3FH              |

**按键操作记录：**

| 操作次数 | 显示内容   | BUF数组内容（从左到右）            |
|---------|-----------|-----------------------------------|
| 初始    | 76543210  | 07H 7DH 6DH 66H 4FH 5BH 06H 3FH  |
| 第1次按键| 65432107  | 7DH 6DH 66H 4FH 5BH 06H 3FH 07H  |
| 第2次按键| 54321076  | 6DH 66H 4FH 5BH 06H 3FH 07H 7DH  |
| 第3次按键| 43210765  | 66H 4FH 5BH 06H 3FH 07H 7DH 6DH  |
| 第4次按键| 32107654  | 4FH 5BH 06H 3FH 07H 7DH 6DH 66H  |

---

### 六、实验现象与分析

#### 实验一现象：

- 按下任意按键，对应的LED立即点亮
- 松开按键，对应的LED立即熄灭
- 可以同时按下多个按键，对应的多个LED同时点亮
- 实现了"按哪个键亮哪个灯"的效果

**原理分析：**
- PA口读取的按键状态直接输出到PB口
- 按键按下时对应位为0，输出0使LED点亮（低电平有效）
- 程序无限循环，实时响应按键操作

---

#### 实验二现象：

- 8位数码管同时显示数字76543210
- 显示稳定，无明显闪烁
- 按下按键，显示内容向左循环移动一位
- 松开按键后才响应下一次按键操作（实现了按键消抖）

**原理分析：**

1. **动态扫描原理：**
   - 程序快速循环扫描8个数码管
   - 每次只点亮一个数码管，显示对应数字
   - 由于扫描速度快，人眼看到的是8个数码管同时亮

2. **位选控制：**
   - 初始位选7FH（0111 1111），选中第1个数码管
   - ROR指令右移，依次变为BFH、DFH、EFH...
   - 依次选中从左到右的数码管

3. **段选控制：**
   - BUF数组存储8个数字的段选码
   - 每次从数组中取出对应位置的段选码
   - 输出到PA口，点亮对应的段

4. **循环左移：**
   - 保存BUF[0]的值
   - 将BUF[1]到BUF[7]依次前移
   - 将保存的BUF[0]放到BUF[7]
   - 实现数组元素循环左移

---

**成绩：**

**批阅教师：** ————————

**日    期：** ————————
